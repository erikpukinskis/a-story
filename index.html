<html>


<!-- LAYOUT -->

<body>
  <div class="two-columns">
    <div class="column">
      <div class="output"></div>
    </div>
    <div class="column">
      <div id="program-header"></div>
      <div class="program"></div>
    </div>
  </div>
</body>



<!-- EDITOR DEPENDENCIES -->

<script src="../build/he.js"></script>
<script src="../build/element.js"></script>
<script src="../build/tree.js"></script>
<script src="../build/library.js"></script>
<script src="../build/function-call.js"></script>
<script src="../build/add-html.js"></script>
<script src="../build/make-it-editable.js"></script>
<script src="../build/tap-out.js"></script>
<script src="menu.js"></script>
<script src="an-expression.js"></script>
<script src="draw-expression.js"></script>






<!-- APP DEPENDENCIES -->

<script>


  var library = new Library()
  var using = library.using.bind(library)

</script>

<script src="../build/bridge-to.library.js"></script>

<script src="../build/draw-scene.library.js"></script>

<script src="../build/add-html.library.js"></script>

<script src="../build/element.library.js"></script>



<!-- DATA -->

<!-- <script src="load-empty-program.js"></script> -->
<script src="load-sample-home-page.js"></script>
<!-- <script src="load-scene.js"></script> -->



<!-- STARTUP -->

<script type="text/javascript">


  var programName = "unnamed"

  function getName() {
    return programName
  }

  function setName(newName) {
    programName = newName
    programChanged()
  }

  var title = element(".program-name", programName)

  makeItEditable(title, getName, setName)

  var header = document.getElementById("program-header")

  addHtml.inside(header, title.html())



  var el = drawExpression(
      loadedProgram)

  document.querySelector(".program").innerHTML = el.html()

  programChanged()



  function programChanged() {
    window.__nrtvFocusSelector = ".output"

    document.querySelector(".output").innerHTML = ""

    var expression = packageAsModule(loadedProgram)

    anExpression.run(expression, programName)
  }

  function packageAsModule(functionLiteral) {
    
    return {
      kind: "function call",
      functionName: "using",
      arguments: [
        {
          kind: "array literal",
          items: argumentNamesToStringLiterals(functionLiteral)
        },
        functionLiteral
      ]
    }

  }

  function argumentNamesToStringLiterals(functionLiteral) {

    return functionLiteral
      .argumentNames
      .map(
        function(camelCase) {
          return anExpression.stringLiteral(
            dasherized(camelCase)
          )
        }
      )

  }

  function dasherized(camelCase) {
    var words = []
    var wordStart = 0

    for(var i=0; i<camelCase.length+1; i++) {

      var letter = camelCase[i]
      var isEnd = i == camelCase.length
      var isUpperCase = letter && letter.toUpperCase() == letter

      if (isUpperCase || isEnd) {
        // new word!
        var word = camelCase.slice(wordStart, i)
        words.push(word.toLowerCase())
        wordStart = i
      }
    }

    return words.join("-")
  }


</script>


<!-- STYLES -->

<link rel="stylesheet" href="styles.css">


</html>
